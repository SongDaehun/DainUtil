<?xml version="1.0" encoding="utf-8" ?>
<root>
  <CUSDEC830A1>
    <![CDATA[    
   SELECT  
   TOP 1
   'EHDR' AS [0000]   
   ,'' AS [0010]
   ,(SELECT TOP 1 REPORTCODE FROM F_GENENV) + RIGHT(LEFT(CONVERT(VARCHAR,GETDATE(),120),4),2) + (SELECT TOP 1 RIGHT('000000' + CONVERT(NVARCHAR,REPORTSEQNO),6) FROM F_GENENV) +'X' AS [0020]
   ,(SELECT TOP 1 REPORTNAME FROM F_GENENV) AS [0030]
   ,(SELECT TOP 1 REPORTCODE FROM F_GENENV) AS [0040]
   ,(SELECT TOP 1 REPORTPRESENTER FROM F_GENENV) AS [0050]
   , CASE HD.DECLARERATIONNUMBER WHEN '0001' THEN (SELECT TOP 1 SHIPPERSEXPORT1CODE FROM F_GENENV) ELSE (SELECT TOP 1 SHIPPERSEXPORTELSECODE FROM F_GENENV) END AS [0060]
   ,(SELECT TOP 1 LEFT(SHIPPERSEXPORT1NAME,28) FROM F_GENENV) AS [0070]
   ,'' AS [0080]
   , CASE HD.DECLARERATIONNUMBER WHEN '0001' THEN (SELECT TOP 1 SHIPPERSEXPORT1CUSTOMSCODE FROM F_GENENV) ELSE (SELECT TOP 1 SHIPPERSEXPORTELSECUSTOMSCODE FROM F_GENENV) END AS [0090]
   , CASE  WHEN DD.PRODUCT LIKE '%케피코%' THEN 'A' ELSE 'C' END AS [0100]
   , CASE HD.DECLARERATIONNUMBER WHEN '0001' THEN (SELECT TOP 1 SHIPPERSEXPORT1CODE FROM F_GENENV) ELSE (SELECT TOP 1 SHIPPERSEXPORTELSECODE FROM F_GENENV) END AS [0110]
   , CASE HD.DECLARERATIONNUMBER WHEN '0001' THEN (SELECT TOP 1 LEFT(SHIPPERSEXPORT1NAME,28) FROM F_GENENV) ELSE (SELECT TOP 1 LEFT(SHIPPERSEXPORTELSENAME,28) FROM F_GENENV) END AS [0120]
    ,  (SELECT TOP 1 LEFT(SHIPPERSEXPORT1PRESENTER,28) FROM F_GENENV)AS [0130]
   ,  (SELECT TOP 1 LEFT(SHIPPERSEXPORT1ADDRESS,35) FROM F_GENENV)AS [0140]
   ,  '' AS [0150]
   ,  LEFT('1238120157',13) AS [0160]
   ,  '04' AS [0170]
   , CASE HD.DECLARERATIONNUMBER WHEN '0001' THEN (SELECT TOP 1 SHIPPERSEXPORT1CUSTOMSCODE FROM F_GENENV) ELSE (SELECT TOP 1 SHIPPERSEXPORTELSECUSTOMSCODE FROM F_GENENV) END AS [0180]
   , CASE HD.DECLARERATIONNUMBER WHEN '0001' THEN (SELECT TOP 1 SHIPPERSEXPORT1POSTALCODE FROM F_GENENV) ELSE (SELECT TOP 1 SHIPPERSEXPORTELSEPOSTALCODE FROM F_GENENV) END AS [0190]
   , CASE  WHEN DD.PRODUCT LIKE '%케피코%' THEN (SELECT TOP 1 SHIPPERSEXPORT1CODE FROM F_GENENV) ELSE (SELECT TOP 1 SHIPPERSEXPORTELSECODE FROM F_GENENV) END AS [0200]
   , CASE  WHEN DD.PRODUCT LIKE '%케피코%' THEN (SELECT TOP 1 SHIPPERSEXPORT1NAME FROM F_GENENV) ELSE (SELECT TOP 1 SHIPPERSEXPORTELSENAME FROM F_GENENV) END AS [0210]
   , CASE  WHEN DD.PRODUCT LIKE '%케피코%' THEN (SELECT TOP 1 SHIPPERSEXPORT1CUSTOMSCODE FROM F_GENENV) ELSE (SELECT TOP 1 SHIPPERSEXPORTELSECUSTOMSCODE FROM F_GENENV) END AS [0220]
   , CASE  WHEN DD.PRODUCT LIKE '%케피코%' THEN (SELECT TOP 1 SHIPPERSEXPORT1POSTALCODE FROM F_GENENV) ELSE (SELECT TOP 1 SHIPPERSEXPORTELSEPOSTALCODE FROM F_GENENV) END AS [0230]
   , '' AS [0240]
   , '' AS [0250]
   , '' AS [0260]
   , '' AS [0270]
   , '' AS [0280]
   , '999' AS [0290]
   ,'KEFICO AUTOMOTIVE BEIJING' AS [300]
   ,'CNKEFICO0003H' AS [310]
   , RIGHT('000' + CONVERT(VARCHAR,HD.LOADINGPORTCODE),3) AS [0320]
   , CASE RIGHT('000' + CONVERT(VARCHAR,HD.LOADINGPORTCODE),3) WHEN '016' THEN '10' WHEN '020' THEN '15' WHEN '040' THEN '15' ELSE '' END AS [0330]
   , '' AS [0340]
   , '' AS [0350]
   , LEFT(REPLACE(CONVERT(VARCHAR,GETDATE(),120),'-',''),8) AS [0360]
   , 'H' AS [0370]
   , '' AS [0380]
   , '11' AS [0390]
   , '' AS [0400]
   , 'A' AS [0410]
    , '' AS [0420]
    , 'TT' AS [0430]
    , '' AS [0440]
    , CASE LEFT(HD.INVOICENO,3) WHEN 'KCP' THEN 'CN' WHEN 'KVP' THEN 'VN' ELSE '' END AS [0450]
    , CASE LEFT(HD.INVOICENO,3) WHEN 'KCP' THEN 'PR.CHNA' WHEN 'KVP' THEN 'VIETNAM' ELSE '' END AS [0460]
     ,CASE RIGHT('000' + CONVERT(VARCHAR,HD.LOADINGPORTCODE),3) WHEN '016' THEN 'KRPTK' WHEN '020' THEN 'KRINC' WHEN '040' THEN 'ICN' ELSE '' END AS [0470]
     ,CASE RIGHT('000' + CONVERT(VARCHAR,HD.LOADINGPORTCODE),3) WHEN '016' THEN '평택항' WHEN '020' THEN '인천항' WHEN '040' THEN '인천공항' ELSE '' END AS [0480]
     , '' AS [0490]
     , CASE RIGHT('000' + CONVERT(VARCHAR,HD.LOADINGPORTCODE),3) WHEN '016' THEN '10' WHEN '020' THEN '10' WHEN '040' THEN '40' ELSE '' END AS [0500]
     , '' AS [0510]
     , 'ETC' AS [0520]
     , '' AS [0530]
     , '' AS [0540]
     , LEFT(REPLACE(CONVERT(VARCHAR,GETDATE(),120),'-',''),8) AS [0550]
     , CASE RIGHT('000' + CONVERT(VARCHAR,HD.LOADINGPORTCODE),3) WHEN '016' THEN '17813' WHEN '020' THEN '22354' WHEN '040' THEN '22379' ELSE '' END AS [0560]
     , CASE RIGHT('000' + CONVERT(VARCHAR,HD.LOADINGPORTCODE),3) WHEN '016' THEN '0015' WHEN '020' THEN '0086' WHEN '040' THEN '1001' ELSE '' END AS [0570]
     , CASE RIGHT('000' + CONVERT(VARCHAR,HD.LOADINGPORTCODE),3) WHEN '016' THEN '평택컨테이너터미날(주)CY 경기도 평택시 포승읍 평택항만길 181-21' WHEN '020' THEN '인천컨테이너터미널(주) 인천광역시 중구 축항대로118번길 135' WHEN '040' THEN '인천국제물류센터(주) 인천 중구 공항동로296번길 98-114' ELSE '' END AS [0580]
     , '' AS [0590]
     , '' AS [0600]
     , 'N' AS [0610]
     , '' AS [0620]
     , '' AS [0630]
     , '' AS [0640]
     , '1' AS [0650]
     , '' AS [0660]
     , '' AS [0670]
     , 'NO' AS [0680]
     , '' AS [0690]
     , 'N' AS [0700]
     , (SELECT SUM(DD2.PL_GWEIGHTKGS) FROM D_CIPL_D DD2 WHERE HD.SEQNO = DD2.SEQNO %1 ) AS [0710]
     , 'KG' AS [0720]
     , (SELECT SUM(DD2.PACKAGEAMOUNT) FROM D_CIPL_D DD2 WHERE HD.SEQNO = DD2.SEQNO %1 ) AS [0730]
     , 'PG' AS [0740]
     , '0' AS [0750]
     , '0' AS [0760]
     , '0' AS [0770]
     , 'KRW' AS [0780]
     , '0' AS [0790]
     , '0' AS [0800]
     , 'KRW' AS [0810]
     , '0' AS [0820]
     ,HD.TERMSOFDELIVERY AS [0830]
     ,'USD' AS [0840]
     , (SELECT SUM(DD2.CI_AMOUNT_USD) FROM D_CIPL_D DD2 WHERE HD.SEQNO = DD2.SEQNO %1 ) AS [0850]
     ,'' AS [0860]
     ,'' AS [0870]
     ,'' AS [0880]
     ,'' AS [0890]
     ,'' AS [0900]
     ,'' AS [0910]
     ,'' AS [0920]
     ,'' AS [0930]
     ,'' AS [0940]
     ,'' AS [0950]
     ,'' AS [0960]
     ,'' AS [0970]
     ,'' AS [0980]
     ,'' AS [0990]
     ,'' AS [1000]
        ,'선적기간 : ' + LEFT(HD.PL_ETD,4) + '-' + SUBSTRING(PL_ETD,5,2) +'-' + RIGHT(PL_ETD,2) + ' - ' 
     +CONVERT(NVARCHAR,dateadd(day,-1,dateadd(month,1,CONVERT(DATE,LEFT(HD.PL_ETD,4)  + SUBSTRING(PL_ETD,5,2) + RIGHT(PL_ETD,2)))))
     AS [1010]
     ,'' AS [1020]
     ,'' AS [1030]
     ,'' AS [1040]
     ,'' AS [1050]
     ,'' AS [1060]
     ,'' AS [1070]
     ,'' AS [1080]
     ,'' AS [1090]
     ,'' AS [1100]
     ,'' AS [1110]
     ,'' AS [1120]
     ,'' AS [1130]
     ,'' AS [1140]
     ,'' AS [1150]
     ,'' AS [1160]
     ,'' AS [1170]
     ,'' AS [1180]
     ,'' AS [1190]
     ,'' AS [1200]
     ,'' AS [1210]
     ,'' AS [1220]
     ,'' AS [1230]
     ,'' AS [1240]
     ,'' AS [1250]
     ,'' AS [1260]
     ,'' AS [1270]
     ,'' AS [1280]
     ,'' AS [1290]
     ,'' AS [1300]
     ,'' AS [1310]
     , CASE RIGHT('000' + CONVERT(VARCHAR,HD.LOADINGPORTCODE),3) WHEN '016' THEN '01612033' WHEN '020' THEN '02077002' WHEN '040' THEN '04099999' ELSE '' END AS [1320]
     ,HD.PL_ETD AS [1330]
     ,'' AS [1340]
     ,'' AS [1350]
     ,'' AS [1360]
     FROM D_CIPL_H HD INNER JOIN D_CIPL_D DD ON HD.SEQNO = DD.SEQNO
     WHERE 1 = 1
    ]]>
  </CUSDEC830A1>
  <CUSDEC830B1>
    <![CDATA[
      
SELECT
'EDTL' AS [3000]
,(SELECT TOP 1 REPORTCODE FROM F_GENENV) + RIGHT(LEFT(CONVERT(VARCHAR,GETDATE(),120),4),2) + (SELECT TOP 1 RIGHT('000000' + CONVERT(NVARCHAR,REPORTSEQNO),6) FROM F_GENENV) +'X'  AS [3010]
,(SELECT TOP 1 REPORTCODE FROM F_GENENV) + RIGHT(LEFT(CONVERT(VARCHAR,GETDATE(),120),4),2) + (SELECT TOP 1 RIGHT('000000' + CONVERT(NVARCHAR,REPORTSEQNO),6) FROM F_GENENV) +'X'  AS [3020]
,ISNULL(DD.RANNUMBER,'000') AS [3030]
,DD.HSCODE AS [3040]
,(SELECT TOP 1 STANDARDPARTNAME FROM M_ITEM MI WHERE DD.PARTNO = MI.PARTNO) AS [3050]
,(SELECT TOP 1 TRADEPARTNAME FROM M_ITEM MI WHERE DD.PARTNO = MI.PARTNO) AS [3060]
, HD.PACKINGLISTNO AS [3070]
 ,'' AS [3080]
 ,'0' AS [3090]
 ,'0' AS [3100]
 ,'' AS [3110]
 ,'' AS [3120]
 ,(SELECT SUM(CI_AMOUNT_USD) FROM D_CIPL_D DD2 WHERE DD.SEQNO = DD2.SEQNO AND DD.CONVENTIONCODE = DD2.CONVENTIONCODE AND DD.HSCODE = DD2.HSCODE AND DD.RANNUMBER = DD2.RANNUMBER) AS [3130]	
 ,(SELECT SUM(PL_NWEIGHTKGS) FROM D_CIPL_D DD2 WHERE DD.SEQNO = DD2.SEQNO  AND DD.CONVENTIONCODE = DD2.CONVENTIONCODE AND DD.HSCODE = DD2.HSCODE AND DD.RANNUMBER = DD2.RANNUMBER) AS [3140]
 ,'' AS [3150]	
 ,(SELECT SUM(PL_QTY) FROM D_CIPL_D DD2 WHERE DD.SEQNO = DD2.SEQNO  AND DD.CONVENTIONCODE = DD2.CONVENTIONCODE AND DD.HSCODE = DD2.HSCODE AND DD.RANNUMBER = DD2.RANNUMBER) AS [3160]
 ,'' AS [3170]	
 ,'' AS [3180]
 ,'' AS [3190]
 ,(SELECT SUM(PACKAGEAMOUNT) FROM D_CIPL_D DD2 WHERE DD.SEQNO = DD2.SEQNO  AND DD.CONVENTIONCODE = DD2.CONVENTIONCODE AND DD.HSCODE = DD2.HSCODE AND DD.RANNUMBER = DD2.RANNUMBER) AS [3200]
     ,CASE DD.PACKAGEAMOUNT WHEN 0 THEN 'VO' ELSE 'PG' END AS [3210]
 ,'KR' AS [3220]
 ,'R.KOREA' AS [3230]
 ,'' AS [3240]
 ,'' AS [3250]
 ,'Y' AS [3270]
 ,'N' AS [3270]
FROM D_CIPL_D DD INNER JOIN D_CIPL_H HD ON HD.SEQNO = DD.SEQNO WHERE  1 = 1
AND DD.DETAILSEQNO IN (SELECT MIN(DETAILSEQNO) FROM D_CIPL_D DD3 WHERE DD3.SEQNO = HD.SEQNO GROUP BY CONVENTIONCODE,HSCODE)
    ]]>
  </CUSDEC830B1>
  <CUSDEC830B5>
    <![CDATA[
    SELECT
    'ECTR' AS [7000]
    ,'' AS [7010]
    ,'' AS [7020]
    ,'' AS [7030]
    ,'' AS [7040]
 FROM D_CIPL_H HD WHERE  1 = 1
    ]]>
  </CUSDEC830B5>
  <CUSDEC830C1>
    <![CDATA[
    SELECT
'EMDL' AS [8000]
,(SELECT TOP 1 REPORTCODE FROM F_GENENV) + RIGHT(LEFT(CONVERT(VARCHAR,GETDATE(),120),4),2) + (SELECT TOP 1 RIGHT('000000' + CONVERT(NVARCHAR,REPORTSEQNO),6) FROM F_GENENV) +'X'  AS [8010]
,(SELECT TOP 1 REPORTCODE FROM F_GENENV) + RIGHT(LEFT(CONVERT(VARCHAR,GETDATE(),120),4),2) + (SELECT TOP 1 RIGHT('000000' + CONVERT(NVARCHAR,REPORTSEQNO),6) FROM F_GENENV) +'X'  AS [8020]
, RIGHT('000' + CONVERT(NVARCHAR,DD.RANNUMBER),3) AS[8030]
, RANDETAILNUMBER AS[8040]
,DD.PARTNO AS [8050]
,DD.PARTNO AS [8060]
,ISNULL(DD.PARTNAME,'') AS [8070]
,'' AS [8080]
,'' AS [8090]
,'' AS [8100]
,'' AS [8110]
,'' AS [8120]
,'' AS [8130]
,'' AS [8140]
,'' AS [8150]
,DD.PL_QTY AS [8160]
,CASE PL_PUN WHEN 'PCS' THEN 'PC' ELSE PL_PUN END AS [8170]
,DD.CI_UPRICE_USD AS [8180]
,DD.CI_AMOUNT_USD AS [8190]
 FROM D_CIPL_D DD INNER JOIN D_CIPL_H HD ON HD.SEQNO = DD.SEQNO WHERE  1 = 1
    ]]>
  </CUSDEC830C1>
  <CUSDEC830D1>
    <![CDATA[
    SELECT 
'DOC4' AS [9000]
,(SELECT TOP 1 REPORTCODE FROM F_GENENV) + RIGHT(LEFT(CONVERT(VARCHAR,GETDATE(),120),4),2) + (SELECT TOP 1 RIGHT('000000' + CONVERT(NVARCHAR,REPORTSEQNO),6) FROM F_GENENV) +'X'  AS [9010]
,(SELECT TOP 1 REPORTCODE FROM F_GENENV) + RIGHT(LEFT(CONVERT(VARCHAR,GETDATE(),120),4),2) + (SELECT TOP 1 RIGHT('000000' + CONVERT(NVARCHAR,REPORTSEQNO),6) FROM F_GENENV) +'X'  AS [9020]
, DD.RANNUMBER AS [9030]
, RIGHT(DD.RANNUMBER,2) AS [9040]
, RIGHT(DD.RANNUMBER,2) AS [9050]
,'53' AS [9060]
,'원자력안전법' AS [9070]
,'' AS [9080]
,'1' AS [9090]
,'A' AS [9100]
,'NO' AS [9110]
,'' AS [9120]
,'' AS [9130]
,'방사성동위원소관련없음. 자동차부품' AS [9140]
FROM D_CIPL_D DD INNER JOIN D_CIPL_H HD ON HD.SEQNO = DD.SEQNO WHERE  1 = 1 AND LEFT(HSCODE,4) = '9026'
 
    ]]>
  </CUSDEC830D1>
  <CUSDEC830D2>
    <![CDATA[
    SELECT
'CAR4' AS [5100]
,(SELECT TOP 1 RIGHT('000000' + CONVERT(NVARCHAR,REPORTSEQNO),6)FROM F_GENENV) AS [5110]
,'' AS [5120]
,(SELECT TOP 1 RIGHT('000000' + CONVERT(NVARCHAR,REPORTSEQNO),3)FROM F_GENENV) AS [5130]
,'' AS [5140]
FROM D_CIPL_D DD INNER JOIN D_CIPL_H HD ON HD.SEQNO = DD.SEQNO
WHERE 1 =1  
    ]]>
  </CUSDEC830D2>
  <CLEAR>
    <![CDATA[
    DROP TABLE D_CIPL_H
DROP TABLE D_CIPL_D
DROP TABLE F_GENENV
DROP TABLE F_LISTOUTITEM
DROP TABLE F_LISTOUTITEM_INI
DROP TABLE M_CUSTOMCODENAME
DROP TABLE M_CUSTOMCODESET
DROP TABLE M_ITEM
DROP TABLE M_STANDARDCODENAME
DROP TABLE M_STANDARDCODESET
DROP TABLE W_CIPL_D
DROP TABLE W_CIPL_H
DROP TABLE W_SINGLETABLE
    ]]>
  </CLEAR>
</root>
